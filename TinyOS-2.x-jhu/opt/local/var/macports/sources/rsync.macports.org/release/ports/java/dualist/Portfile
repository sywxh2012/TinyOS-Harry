# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 81620 2011-08-03 02:30:47Z hum@macports.org $

PortSystem          1.0

name                dualist
version             0.1
revision            1
categories          java math textproc
platforms           darwin
maintainers         hum openmaintainer
license             Apache-2.0

description         An interactive machine learning system for building classifiers quickly.

long_description    DUALIST is an interactive machine learning system for building classifiers \
                    quickly. It does so by asking \"questions\" of the user in the form of both data \
                    instances (e.g., text documents) and features (e.g., words or phrases). It \
                    utilizes active and semi-supervised learning to quickly train a multinomial \
                    naive Bayes classifier for this setting.

homepage            http://code.google.com/p/dualist/
master_sites        googlecode:${name}

checksums           sha1    7a2fc1fd432c71e2575a1514a946bbf68652fdfa \
                    rmd160  8b4ca3fcd3ec42eeda43235c246390f07a849998

depends_run         port:play

use_zip             yes
worksrcdir          ${name}

set java_home       /System/Library/Frameworks/JavaVM.framework/Versions/1.6/Home

pre-configure {
    if {![file exists ${java_home}]} {
        ui_error "Java 1.6 is required, but not located at ${java_home}"
        return -code error "Java 1.6 missing"
    }
}

use_configure       no
supported_archs     noarch

build.cmd           true

set share_java_dir  ${prefix}/share/java
set dualist_dir     ${share_java_dir}/${worksrcdir}

destroot {
    # Copy the distribution.
    xinstall -m 755 -d  ${destroot}${share_java_dir}
    copy ${worksrcpath} ${destroot}${share_java_dir}

    # Configure working directories.
    xinstall -m 1777 -d ${destroot}${dualist_dir}/tmp
    file attributes     ${destroot}${dualist_dir}/public/results -permissions 01777
    destroot.keepdirs   ${destroot}${dualist_dir}/tmp \
                        ${destroot}${dualist_dir}/public/results

    # Install an extra script for this port.
    xinstall -m 755 ${filespath}/dualist     ${destroot}${prefix}/bin
    reinplace "s|@prefix@|${prefix}|g"       ${destroot}${prefix}/bin/dualist
    reinplace "s|@java_home@|${java_home}|g" ${destroot}${prefix}/bin/dualist
}

notes "To try DUALIST, run 'dualist' and open http://localhost:9000/."

post-deactivate {
    ui_msg "To revert the system after uninstalling the port,"
    ui_msg "delete the dualist directory:"
    ui_msg "  $ sudo rm -rf ${dualist_dir}"
}

variant mecab description {Use MeCab to analyze Japanese texts} {
    depends_lib-append port:mecab-java
    patchfiles-append  patch-mecab.diff

    post-extract {
        xinstall -m 644 -W ${filespath} \
            Makefile \
            SimpleMecabPipe.java \
            ${worksrcpath}
        file link -symbolic ${worksrcpath}/lib/mecab.jar ${prefix}/share/java/mecab.jar
    }

    post-patch {
        reinplace "s|@java_home@|${java_home}|g" ${worksrcpath}/Makefile
    }
        
    build.cmd  make

    post-destroot {
        # Install an extra script for this variant.
        xinstall -m 755 ${filespath}/dualist-mecab ${destroot}${prefix}/bin
        reinplace "s|@prefix@|${prefix}|g"         ${destroot}${prefix}/bin/dualist-mecab
        reinplace "s|@java_home@|${java_home}|g"   ${destroot}${prefix}/bin/dualist-mecab
    }

    notes-append "For Japanese texts, run 'dualist-mecab' instead of 'dualist'."
}

livecheck.type      regex
livecheck.url       http://code.google.com/p/dualist/downloads/list
livecheck.regex     ${name}-(\[0-9.\]+)\.zip

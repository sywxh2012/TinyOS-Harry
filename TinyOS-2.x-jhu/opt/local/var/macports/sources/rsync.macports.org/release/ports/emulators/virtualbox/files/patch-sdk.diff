--- src/libs/xpcom18a4/Config.kmk.orig	2011-09-18 13:23:09.000000000 +0200
+++ src/libs/xpcom18a4/Config.kmk	2011-09-18 13:25:01.000000000 +0200
@@ -251,6 +251,17 @@
 TEMPLATE_XPCOMOSX106_DEFS.darwin        = $(filter-out $(VBOX_DARWIN_DEF_SDK_DEFS),$(TEMPLATE_XPCOM_DEFS.darwin)) $(VBOX_DARWIN_DEF_SDK_10_6_DEFS)
 TEMPLATE_XPCOMOSX106_INCS.darwin        = $(VBOX_PATH_MACOSX_SDK_10_6)/Developer/Headers/FlatCarbon
 
+# Template for building VBoxPython against the Mac OS X 10.7 SDK.
+# ASSUMES that the SDK bits are in the .darwin properties we're overriding below.
+#
+TEMPLATE_XPCOMOSX107                    = XPCOM libraries (shared) built against the Mac OS X 10.6 SDK
+TEMPLATE_XPCOMOSX107_EXTENDS            = XPCOM
+TEMPLATE_XPCOMOSX107_CXXFLAGS.darwin    = $(filter-out $(VBOX_DARWIN_DEF_SDK_CXXFLAGS),$(TEMPLATE_XPCOM_CXXFLAGS.darwin)) $(VBOX_DARWIN_DEF_SDK_10_7_CXXFLAGS)
+TEMPLATE_XPCOMOSX107_CFLAGS.darwin      = $(filter-out $(VBOX_DARWIN_DEF_SDK_CFLAGS),$(TEMPLATE_XPCOM_CFLAGS.darwin)) $(VBOX_DARWIN_DEF_SDK_10_7_CFLAGS)
+TEMPLATE_XPCOMOSX107_LDFLAGS.darwin     = $(filter-out $(VBOX_DARWIN_DEF_SDK_LDFLAGS),$(TEMPLATE_XPCOM_LDFLAGS.darwin)) $(VBOX_DARWIN_DEF_SDK_10_7_LDFLAGS)
+TEMPLATE_XPCOMOSX107_DEFS.darwin        = $(filter-out $(VBOX_DARWIN_DEF_SDK_DEFS),$(TEMPLATE_XPCOM_DEFS.darwin)) $(VBOX_DARWIN_DEF_SDK_10_7_DEFS)
+TEMPLATE_XPCOMOSX107_INCS.darwin        = $(VBOX_PATH_MACOSX_SDK_10_7)/Developer/Headers/FlatCarbon
+
 
 #
 # The list of XPCOM's IDL files.
--- src/libs/xpcom18a4/python/Makefile.kmk.orig	2011-09-18 12:18:06.000000000 +0200
+++ src/libs/xpcom18a4/python/Makefile.kmk	2011-09-18 13:21:53.000000000 +0200
@@ -126,7 +126,7 @@
 VBoxPython2_6_LIBS       = $(VBOX_PYTHON26_LIB)
 endif
 
-if defined(VBOX_PYTHON27_INC) && "$(KBUILD_TARGET)" != "darwin"
+if defined(VBOX_PYTHON27_INC) && ("$(KBUILD_TARGET)" != "darwin" || "$(VBOX_DEF_MACOSX_VERSION_MIN)" <= "10.7")
 #
 # Python 2.7 version
 #
--- src/libs/xpcom18a4/python/gen_python_deps.py.orig	2011-09-18 13:04:36.000000000 +0200
+++ src/libs/xpcom18a4/python/gen_python_deps.py	2011-09-18 13:05:02.000000000 +0200
@@ -74,7 +74,7 @@
 
     if target == 'darwin':
         ## @todo Pick up the locations from VBOX_PATH_MACOSX_SDK_10_*.
-        prefixes = ['/Developer/SDKs/MacOSX10.4u.sdk/usr', '/Developer/SDKs/MacOSX10.5.sdk/usr', '/Developer/SDKs/MacOSX10.6.sdk/usr']
+        prefixes = ['/Developer/SDKs/MacOSX10.4u.sdk/usr', '/Developer/SDKs/MacOSX10.5.sdk/usr', '/Developer/SDKs/MacOSX10.6.sdk/usr', '/Developer/SDKs/MacOSX10.7.sdk/usr']
         dllsuff = '.dylib'
 
     if target == 'solaris' and arch == 'amd64':

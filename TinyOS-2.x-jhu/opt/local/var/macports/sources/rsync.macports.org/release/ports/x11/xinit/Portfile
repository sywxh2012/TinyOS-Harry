# $Id: Portfile 89810 2012-02-11 08:55:39Z and.damore@macports.org $

PortSystem          1.0

name                xinit
version             1.3.1
categories          x11
platforms           darwin
maintainers         jeremyhu openmaintainer
description         X11 startup script processor
long_description    xinit is responsible for configuring the initial environment \
		    when X11 starts up.

homepage            http://www.x.org
master_sites        xorg:individual/app/

checksums           md5     ee234056d8a3dbf37b61b4bcb35b88e4 \
                    sha1    6d3981c23ce49212a26912651d6d2473a5065766 \
                    rmd160  aadb0729c65438819cfaae4733f512574fa39c2d

use_bzip2	    yes
use_parallel_build  yes

depends_run         bin:xauth:xauth \
                    bin:xset:xset \
                    bin:xrdb:xrdb \
                    port:mkfontscale \
                    port:mkfontdir

depends_build       port:pkgconfig

depends_lib         port:xorg-libX11

patchfiles \
	0001-darwin-Buildfix-for-Tiger-which-doesn-t-have-posix_s.patch
patch.pre_args -p1

configure.args --with-launchd-id-prefix=org.macports

configure.args-append   RAWCPP=${configure.cpp}

post-destroot {
	if {${os.platform} == "darwin" && [vercmp ${os.version} 10.3.0] < 0} {
		file delete -force ${destroot}/Library/LaunchAgents/org.macports.startx.plist
	}

	xinstall -d ${destroot}${prefix}/lib/X11/xinit/xinitrc.d
	eval xinstall -m 755 [glob ${filespath}/xinitrc.d/*.sh] ${destroot}${prefix}/lib/X11/xinit/xinitrc.d
	xinstall -m 755 ${filespath}/font_cache.sh ${destroot}${prefix}/bin/font_cache

	eval reinplace "s|__PREFIX__|${prefix}|g" \
		[glob ${destroot}${prefix}/lib/X11/xinit/xinitrc.d/*.sh] \
		${destroot}${prefix}/bin/font_cache
}

install.asroot      yes
